{"changed":true,"filter":false,"title":"views.py","tooltip":"/application_task_for_seminar/project/api_v1/views.py","value":"from django.http import HttpResponse, JsonResponse\nfrom django.views.decorators.csrf import csrf_exempt\n# JSONパーサー&レンダラー\nfrom rest_framework.renderers import JSONRenderer\nfrom rest_framework.parsers import JSONParser\n# シリアライザ (db操作用のController的な役割)\nfrom api_v1.serializers import UserSerializer, TokenSerializer, ImageSerializer, PostSerializer, FavoriteSerializer\n# パスワードhasher\nfrom django.contrib.auth.hashers import make_password, check_password\n# Json形成\nfrom django.utils.six import BytesIO\n# ハッシュ化\nimport hashlib\n# タイムスタンプ用\nfrom django.utils import timezone\n# ファイル名取得\nimport os.path\n# import for file upload\nimport os\n# レスポンス\nfrom rest_framework.response import Response\n\n\n\n# ファイルの保存先のパス\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nUPLOADE_DIR = os.path.join(BASE_DIR, 'uploaded_files/api_v1/images')\n\n# サーチ関数（緯度，経度から周辺情報を取得）\nimport requests\nimport urllib.error\nimport urllib.request\nimport json\n\n\ndef search(lat, lon):\n    baseurl = 'https://map.yahooapis.jp/search/local/V1/localSearch'\n    params = {\n        'appid': 'dj00aiZpPUxkZnlIN0YwM3dZNSZzPWNvbnN1bWVyc2VjcmV0Jng9MmU-',\n        'output': 'json',\n        'sort': 'score',\n        'start': 1,\n        'results': '20',\n        'lat': str(lat),\n        'lon': str(lon),\n        'dist': 1,\n    }\n    url = '{}?{}'.format(baseurl, urllib.parse.urlencode(params))\n    res = requests.get(url)\n    result = []\n    ydf = json.loads(res.text)\n    search_result = []\n\n    features = ydf['Feature']\n    if ydf['ResultInfo']['Count']:\n        total = ydf['ResultInfo']['Total']\n\n        for f in features:\n            if f['Geometry']['Type'] == 'point':\n                ll = f['Geometry']['Coordinates'].split(',')\n                poi = {\n                    'uid': f['Property']['Uid'],\n                    'name': f['Name'],\n                    'station': f['Property']['Station'],\n                    'lat': ll[1],\n                    'lon': ll[0]\n                }\n                result.append(poi)\n\n        for i, poi in enumerate(result, 1):\n            search_result.append(\n                '{uid},{name},{lon},{lat}'.format(\n                    name=poi['name'],\n                    uid=poi['uid'],\n                    lon=poi['lon'],\n                    lat=poi['lat']\n                )\n            )\n    return search_result\n\n# ユーザー登録API\n@csrf_exempt # APIなので、csrf対策を無効にする\ndef register(request):\n    # POST\n    if request.method == 'POST':\n        # JSONをパース\n        data = JSONParser().parse(request)\n        # Userモデルに当てはめる\n        serializer = UserSerializer(data=data)\n\n        # バリデーションを掛ける(パスワードはハッシュ化するので、空文字判定を先に行う)\n       # パスワードが空かを確認する\n        if serializer.initial_data[\"password\"] == \"\":\n            return HttpResponse(\"使用できないパスワードです。\", status=403)\n\n        # パスワードをハッシュ化\n        serializer.initial_data[\"password\"] = make_password(serializer.initial_data[\"password\"], hasher='argon2')\n\n        # 有効なものかを判断する\n        if serializer.is_valid():\n            # 保存\n            try:\n                serializer.save()\n                # ユーザーIDを取得\n                user = UserSerializer.select(user_name=serializer.initial_data[\"account_name\"])\n                # トークン生成\n                token = TokenSerializer.create(user)\n                # ユーザーにトークンを渡す\n                data = '{\"token\": \"' + token +'\"}'\n                response = HttpResponse(data, status=200)\n                response['content-type'] = 'application/json; charset=utf-8'\n                return response\n            # account_nameがかぶったときなどのエラー処理\n            except Exception as e:\n                print(e)\n                return HttpResponse(\"ユーザー名が使われています\", status=409)\n        # 不正なリクエストの場合\n        return HttpResponse(\"不正なリクエスト\", status=400)\n    else:\n        return HttpResponse(\"不正なリクエスト\", status=400)\n\n# ユーザーログインAPI\n@csrf_exempt # APIなので、csrf対策を無効にする\ndef login(request):\n    # POST\n    if request.method == 'POST':\n        # JSONをパース\n        data = JSONParser().parse(request)\n        # Userモデルに当てはめる\n        serializer = UserSerializer(data=data)\n        # 有効なものかを判断する\n        if serializer.is_valid():\n            try:\n                # ユーザーを取得\n                user = UserSerializer.select(user_name=serializer.initial_data[\"account_name\"])\n            except:\n                return HttpResponse(\"ユーザーが存在しません\", status=401)\n\n            # ログイン成功時\n            if check_password(serializer.data[\"password\"], user.password):\n                # トークン生成\n                token = TokenSerializer.create(user)\n                # ユーザーにトークンを渡す\n                data = '{\"token\": \"' + token +'\"}'\n                response = HttpResponse(data, status=200)\n                response['content-type'] = 'application/json; charset=utf-8'\n                return response\n            # ログイン失敗時\n            else:\n                return HttpResponse(\"ログイン失敗\", status=401)\n        # 不正なリクエスト\n        return HttpResponse(\"不正なリクエスト\", status=400)\n    else:\n        return HttpResponse(\"不正なリクエスト\", status=400)\n\n# 画像API\n@csrf_exempt\ndef images(request):\n    # トークンの認証\n    if request.META['HTTP_AUTHORIZATION']:\n        # Bearerスキームを取り除いて、tokenを認証し、userオブジェクトを得る\n        user = TokenSerializer.auth(request.META['HTTP_AUTHORIZATION'].replace(\"Bearer \", \"\"))\n        # トークンに紐付けられたアカウントが無かった場合\n        if not user:\n            response = HttpResponse(\"token is wrong\", status=401)\n            response[\"WWW-Authenticate\"] = 'realm=\"The access token was expired\", error=\"invalid_token\"'\n            return response\n    # トークンが空の場合\n    else:\n        response = HttpResponse(\"token is empty\", status=401)\n        response[\"WWW-Authenticate\"] = 'realm=\"token is empty\", error=\"invalid_token\"'\n        return response\n\n    # GETメソッド\n    if request.method == 'GET':\n        # レスポンスをつくる\n        response = HttpResponse(ImageSerializer.select(user.id), status=200)\n        response['content-type'] = 'application/json; charset=utf-8'\n        return response\n    # POSTメソッド\n    elif request.method == 'POST':\n        # ファイルアップロード（複数）\n        # ファイルのリストをとる\n        try:\n            files = request.FILES.getlist('file[]')\n        except Exception as e:\n            print(e)\n            return HttpResponse(\"file is empty\", status=400)\n\n        # 一つづつファイル操作\n        for i in range(len(files)):\n            # ファイル名と拡張子を別にする\n            name, ext = os.path.splitext(str(files[i]))\n            # バリデーションを掛ける\n            if (ext == '.jpeg') or (ext == '.png') or (ext == 'jpg'):\n                # ファイルネームのハッシュ化(URLに使えない文字を消す為)\n                name = hashlib.sha1(name.encode('utf-8')).hexdigest()[:10]\n                # タイムスタンプを付けて、ファイルのリネーム\n                dt = timezone.now()\n                file_name = name + dt.strftime('%Y%m%d%H%M%S%f') + ext\n                # パスの指定\n                path1 = os.path.join(UPLOADE_DIR, file_name)\n                # ファイルを保存\n                with open(path1, 'wb') as ff:\n                    ff.write(files[i].file.read())\n\n                # データベースに保存\n                ImageSerializer.create(file_path=file_name, user_info=user)\n            # 画像ファイル以外の拡張子が来た時\n            else:\n                return HttpResponse(\"jpeg, jpg, pngのみ対応しています。\", status=406)\n\n        return HttpResponse(\"Success\")\n\n    # その他\n    else:\n        return HttpResponse(\"不正なリクエスト\", status=400)\n\n# レコメンドAPI\n@csrf_exempt\ndef reccomend(request):\n    if request.method == 'GET':\n        posts = Post.objects.all()\n        serializer = PostSerializer(posts, many=True)\n        response = HttpResponse(serializer.data, status=200)\n        response['content-type'] = 'application/json; charset=utf-8'\n        print(response)\n        return response\n\n# api viewer(debug用)\nimport django_filters\nfrom rest_framework import viewsets, filters\nfrom api_v1.models import User, Token, Image, Post, Favorite\n\n# Create your views here.\nclass UserViewSet(viewsets.ModelViewSet):\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n\nclass TokenViewSet(viewsets.ModelViewSet):\n    queryset = Token.objects.all()\n    serializer_class = TokenSerializer\n\nclass ImageViewSet(viewsets.ModelViewSet):\n    queryset = Image.objects.all()\n    serializer_class = ImageSerializer\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n\nclass FavoriteViewSet(viewsets.ModelViewSet):\n    queryset = Favorite.objects.all()\n    serializer_class = FavoriteSerializer\n","undoManager":{"mark":98,"position":100,"stack":[[{"start":{"row":218,"column":54},"end":{"row":219,"column":0},"action":"insert","lines":["",""],"id":169},{"start":{"row":219,"column":0},"end":{"row":219,"column":8},"action":"insert","lines":["        "]},{"start":{"row":219,"column":8},"end":{"row":219,"column":9},"action":"insert","lines":["r"]},{"start":{"row":219,"column":9},"end":{"row":219,"column":10},"action":"insert","lines":["e"]}],[{"start":{"row":219,"column":10},"end":{"row":219,"column":11},"action":"insert","lines":["s"],"id":170},{"start":{"row":219,"column":11},"end":{"row":219,"column":12},"action":"insert","lines":["u"]},{"start":{"row":219,"column":12},"end":{"row":219,"column":13},"action":"insert","lines":["l"]},{"start":{"row":219,"column":13},"end":{"row":219,"column":14},"action":"insert","lines":["t"]}],[{"start":{"row":219,"column":14},"end":{"row":219,"column":15},"action":"insert","lines":[" "],"id":171},{"start":{"row":219,"column":15},"end":{"row":219,"column":16},"action":"insert","lines":["="]}],[{"start":{"row":219,"column":16},"end":{"row":219,"column":17},"action":"insert","lines":[" "],"id":172}],[{"start":{"row":219,"column":17},"end":{"row":219,"column":18},"action":"insert","lines":["P"],"id":173},{"start":{"row":219,"column":18},"end":{"row":219,"column":19},"action":"insert","lines":["o"]},{"start":{"row":219,"column":19},"end":{"row":219,"column":20},"action":"insert","lines":["s"]},{"start":{"row":219,"column":20},"end":{"row":219,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":219,"column":19},"end":{"row":219,"column":20},"action":"remove","lines":["s"],"id":174},{"start":{"row":219,"column":18},"end":{"row":219,"column":19},"action":"remove","lines":["o"]},{"start":{"row":219,"column":17},"end":{"row":219,"column":18},"action":"remove","lines":["P"]}],[{"start":{"row":219,"column":17},"end":{"row":219,"column":18},"action":"remove","lines":["t"],"id":175}],[{"start":{"row":219,"column":17},"end":{"row":219,"column":18},"action":"insert","lines":["P"],"id":176},{"start":{"row":219,"column":18},"end":{"row":219,"column":19},"action":"insert","lines":["o"]},{"start":{"row":219,"column":19},"end":{"row":219,"column":20},"action":"insert","lines":["s"]},{"start":{"row":219,"column":20},"end":{"row":219,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":219,"column":17},"end":{"row":219,"column":21},"action":"remove","lines":["Post"],"id":177},{"start":{"row":219,"column":17},"end":{"row":219,"column":31},"action":"insert","lines":["PostSerializer"]}],[{"start":{"row":219,"column":31},"end":{"row":219,"column":33},"action":"insert","lines":["()"],"id":178}],[{"start":{"row":219,"column":32},"end":{"row":219,"column":33},"action":"insert","lines":["r"],"id":179},{"start":{"row":219,"column":33},"end":{"row":219,"column":34},"action":"insert","lines":["e"]},{"start":{"row":219,"column":34},"end":{"row":219,"column":35},"action":"insert","lines":["s"]},{"start":{"row":219,"column":35},"end":{"row":219,"column":36},"action":"insert","lines":["u"]},{"start":{"row":219,"column":36},"end":{"row":219,"column":37},"action":"insert","lines":["l"]},{"start":{"row":219,"column":37},"end":{"row":219,"column":38},"action":"insert","lines":["t"]},{"start":{"row":219,"column":38},"end":{"row":219,"column":39},"action":"insert","lines":[","]}],[{"start":{"row":219,"column":39},"end":{"row":219,"column":40},"action":"insert","lines":[" "],"id":180}],[{"start":{"row":219,"column":40},"end":{"row":219,"column":41},"action":"insert","lines":["m"],"id":181},{"start":{"row":219,"column":41},"end":{"row":219,"column":42},"action":"insert","lines":["a"]},{"start":{"row":219,"column":42},"end":{"row":219,"column":43},"action":"insert","lines":["n"]},{"start":{"row":219,"column":43},"end":{"row":219,"column":44},"action":"insert","lines":["y"]},{"start":{"row":219,"column":44},"end":{"row":219,"column":45},"action":"insert","lines":["="]}],[{"start":{"row":219,"column":45},"end":{"row":219,"column":46},"action":"insert","lines":["T"],"id":182},{"start":{"row":219,"column":46},"end":{"row":219,"column":47},"action":"insert","lines":["r"]},{"start":{"row":219,"column":47},"end":{"row":219,"column":48},"action":"insert","lines":["u"]},{"start":{"row":219,"column":48},"end":{"row":219,"column":49},"action":"insert","lines":["e"]}],[{"start":{"row":218,"column":52},"end":{"row":218,"column":53},"action":"remove","lines":["5"],"id":183},{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"remove","lines":[":"]}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"insert","lines":["0"],"id":184}],[{"start":{"row":219,"column":40},"end":{"row":219,"column":49},"action":"remove","lines":["many=True"],"id":185},{"start":{"row":219,"column":39},"end":{"row":219,"column":40},"action":"remove","lines":[" "]},{"start":{"row":219,"column":38},"end":{"row":219,"column":39},"action":"remove","lines":[","]}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"remove","lines":["0"],"id":186}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"insert","lines":["1"],"id":187}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"remove","lines":["1"],"id":201}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"insert","lines":[";"],"id":202}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"remove","lines":[";"],"id":203}],[{"start":{"row":218,"column":51},"end":{"row":218,"column":52},"action":"insert","lines":[":"],"id":204},{"start":{"row":218,"column":52},"end":{"row":218,"column":53},"action":"insert","lines":["5"]}],[{"start":{"row":219,"column":38},"end":{"row":219,"column":40},"action":"insert","lines":["[]"],"id":205}],[{"start":{"row":219,"column":39},"end":{"row":219,"column":40},"action":"insert","lines":["0"],"id":206}],[{"start":{"row":220,"column":0},"end":{"row":221,"column":68},"action":"remove","lines":["        response = HttpResponse(result, status=200)","        response['content-type'] = 'application/json; charset=utf-8'"],"id":207}],[{"start":{"row":221,"column":22},"end":{"row":221,"column":23},"action":"remove","lines":["e"],"id":208},{"start":{"row":221,"column":21},"end":{"row":221,"column":22},"action":"remove","lines":["s"]},{"start":{"row":221,"column":20},"end":{"row":221,"column":21},"action":"remove","lines":["n"]},{"start":{"row":221,"column":19},"end":{"row":221,"column":20},"action":"remove","lines":["o"]},{"start":{"row":221,"column":18},"end":{"row":221,"column":19},"action":"remove","lines":["p"]},{"start":{"row":221,"column":17},"end":{"row":221,"column":18},"action":"remove","lines":["s"]},{"start":{"row":221,"column":16},"end":{"row":221,"column":17},"action":"remove","lines":["e"]},{"start":{"row":221,"column":15},"end":{"row":221,"column":16},"action":"remove","lines":["r"]}],[{"start":{"row":221,"column":15},"end":{"row":221,"column":16},"action":"insert","lines":["r"],"id":209},{"start":{"row":221,"column":16},"end":{"row":221,"column":17},"action":"insert","lines":["e"]},{"start":{"row":221,"column":17},"end":{"row":221,"column":18},"action":"insert","lines":["s"]},{"start":{"row":221,"column":18},"end":{"row":221,"column":19},"action":"insert","lines":["i"]},{"start":{"row":221,"column":19},"end":{"row":221,"column":20},"action":"insert","lines":[";"]},{"start":{"row":221,"column":20},"end":{"row":221,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":221,"column":20},"end":{"row":221,"column":21},"action":"remove","lines":["t"],"id":210},{"start":{"row":221,"column":19},"end":{"row":221,"column":20},"action":"remove","lines":[";"]},{"start":{"row":221,"column":18},"end":{"row":221,"column":19},"action":"remove","lines":["i"]}],[{"start":{"row":221,"column":18},"end":{"row":221,"column":19},"action":"insert","lines":["u"],"id":211},{"start":{"row":221,"column":19},"end":{"row":221,"column":20},"action":"insert","lines":["l"]},{"start":{"row":221,"column":20},"end":{"row":221,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":221,"column":21},"end":{"row":221,"column":22},"action":"insert","lines":["."],"id":212},{"start":{"row":221,"column":22},"end":{"row":221,"column":23},"action":"insert","lines":["d"]},{"start":{"row":221,"column":23},"end":{"row":221,"column":24},"action":"insert","lines":["a"]},{"start":{"row":221,"column":24},"end":{"row":221,"column":25},"action":"insert","lines":["t"]},{"start":{"row":221,"column":25},"end":{"row":221,"column":26},"action":"insert","lines":["a"]}],[{"start":{"row":219,"column":41},"end":{"row":219,"column":42},"action":"insert","lines":[","],"id":213}],[{"start":{"row":219,"column":42},"end":{"row":219,"column":43},"action":"insert","lines":[" "],"id":214},{"start":{"row":219,"column":43},"end":{"row":219,"column":44},"action":"insert","lines":["m"]},{"start":{"row":219,"column":44},"end":{"row":219,"column":45},"action":"insert","lines":["a"]},{"start":{"row":219,"column":45},"end":{"row":219,"column":46},"action":"insert","lines":["n"]},{"start":{"row":219,"column":46},"end":{"row":219,"column":47},"action":"insert","lines":["y"]},{"start":{"row":219,"column":47},"end":{"row":219,"column":48},"action":"insert","lines":["="]}],[{"start":{"row":219,"column":48},"end":{"row":219,"column":49},"action":"insert","lines":["T"],"id":215},{"start":{"row":219,"column":49},"end":{"row":219,"column":50},"action":"insert","lines":["r"]},{"start":{"row":219,"column":50},"end":{"row":219,"column":51},"action":"insert","lines":["u"]},{"start":{"row":219,"column":51},"end":{"row":219,"column":52},"action":"insert","lines":["e"]}],[{"start":{"row":219,"column":40},"end":{"row":219,"column":41},"action":"remove","lines":["]"],"id":216},{"start":{"row":219,"column":39},"end":{"row":219,"column":40},"action":"remove","lines":["0"]},{"start":{"row":219,"column":38},"end":{"row":219,"column":39},"action":"remove","lines":["["]}],[{"start":{"row":219,"column":7},"end":{"row":219,"column":14},"action":"remove","lines":[" result"],"id":217}],[{"start":{"row":219,"column":7},"end":{"row":219,"column":8},"action":"insert","lines":[" "],"id":218}],[{"start":{"row":219,"column":8},"end":{"row":219,"column":9},"action":"insert","lines":["s"],"id":219},{"start":{"row":219,"column":9},"end":{"row":219,"column":10},"action":"insert","lines":["e"]},{"start":{"row":219,"column":10},"end":{"row":219,"column":11},"action":"insert","lines":["l"]},{"start":{"row":219,"column":11},"end":{"row":219,"column":12},"action":"insert","lines":["i"]},{"start":{"row":219,"column":12},"end":{"row":219,"column":13},"action":"insert","lines":["a"]},{"start":{"row":219,"column":13},"end":{"row":219,"column":14},"action":"insert","lines":["z"]},{"start":{"row":219,"column":14},"end":{"row":219,"column":15},"action":"insert","lines":["i"]}],[{"start":{"row":219,"column":14},"end":{"row":219,"column":15},"action":"remove","lines":["i"],"id":220},{"start":{"row":219,"column":13},"end":{"row":219,"column":14},"action":"remove","lines":["z"]}],[{"start":{"row":219,"column":13},"end":{"row":219,"column":14},"action":"insert","lines":["l"],"id":221},{"start":{"row":219,"column":14},"end":{"row":219,"column":15},"action":"insert","lines":["i"]},{"start":{"row":219,"column":15},"end":{"row":219,"column":16},"action":"insert","lines":["z"]},{"start":{"row":219,"column":16},"end":{"row":219,"column":17},"action":"insert","lines":["e"]},{"start":{"row":219,"column":17},"end":{"row":219,"column":18},"action":"insert","lines":["r"]}],[{"start":{"row":218,"column":0},"end":{"row":221,"column":26},"action":"remove","lines":["        result = Post.objects.order_by('like_cnt')[:5]","        selializer = PostSerializer(result, many=True)","","        return result.data"],"id":222},{"start":{"row":218,"column":0},"end":{"row":220,"column":40},"action":"insert","lines":["        snippets = Snippet.objects.all()","        serializer = SnippetSerializer(snippets, many=True)","        return Response(serializer.data)"]}],[{"start":{"row":218,"column":25},"end":{"row":218,"column":26},"action":"remove","lines":["t"],"id":223},{"start":{"row":218,"column":24},"end":{"row":218,"column":25},"action":"remove","lines":["e"]},{"start":{"row":218,"column":23},"end":{"row":218,"column":24},"action":"remove","lines":["p"]},{"start":{"row":218,"column":22},"end":{"row":218,"column":23},"action":"remove","lines":["p"]},{"start":{"row":218,"column":21},"end":{"row":218,"column":22},"action":"remove","lines":["i"]},{"start":{"row":218,"column":20},"end":{"row":218,"column":21},"action":"remove","lines":["n"]},{"start":{"row":218,"column":19},"end":{"row":218,"column":20},"action":"remove","lines":["S"]}],[{"start":{"row":218,"column":19},"end":{"row":218,"column":20},"action":"insert","lines":["P"],"id":224},{"start":{"row":218,"column":20},"end":{"row":218,"column":21},"action":"insert","lines":["o"]},{"start":{"row":218,"column":21},"end":{"row":218,"column":22},"action":"insert","lines":["s"]},{"start":{"row":218,"column":22},"end":{"row":218,"column":23},"action":"insert","lines":["t"]}],[{"start":{"row":218,"column":8},"end":{"row":218,"column":16},"action":"remove","lines":["snippets"],"id":225}],[{"start":{"row":218,"column":8},"end":{"row":218,"column":9},"action":"insert","lines":["p"],"id":226},{"start":{"row":218,"column":9},"end":{"row":218,"column":10},"action":"insert","lines":["o"]},{"start":{"row":218,"column":10},"end":{"row":218,"column":11},"action":"insert","lines":["s"]},{"start":{"row":218,"column":11},"end":{"row":218,"column":12},"action":"insert","lines":["t"]},{"start":{"row":218,"column":12},"end":{"row":218,"column":13},"action":"insert","lines":["s"]}],[{"start":{"row":219,"column":21},"end":{"row":219,"column":28},"action":"remove","lines":["Snippet"],"id":227}],[{"start":{"row":219,"column":21},"end":{"row":219,"column":22},"action":"insert","lines":["P"],"id":228},{"start":{"row":219,"column":22},"end":{"row":219,"column":23},"action":"insert","lines":["o"]},{"start":{"row":219,"column":23},"end":{"row":219,"column":24},"action":"insert","lines":["s"]},{"start":{"row":219,"column":24},"end":{"row":219,"column":25},"action":"insert","lines":["t"]}],[{"start":{"row":219,"column":37},"end":{"row":219,"column":44},"action":"remove","lines":["nippets"],"id":229},{"start":{"row":219,"column":36},"end":{"row":219,"column":37},"action":"remove","lines":["s"]}],[{"start":{"row":219,"column":36},"end":{"row":219,"column":37},"action":"insert","lines":["p"],"id":230},{"start":{"row":219,"column":37},"end":{"row":219,"column":38},"action":"insert","lines":["o"]},{"start":{"row":219,"column":38},"end":{"row":219,"column":39},"action":"insert","lines":["s"]},{"start":{"row":219,"column":39},"end":{"row":219,"column":40},"action":"insert","lines":["t"]},{"start":{"row":219,"column":40},"end":{"row":219,"column":41},"action":"insert","lines":["s"]}],[{"start":{"row":18,"column":9},"end":{"row":19,"column":0},"action":"insert","lines":["",""],"id":231},{"start":{"row":19,"column":0},"end":{"row":20,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":20,"column":0},"end":{"row":20,"column":44},"action":"insert","lines":["from rest_framework.response import Response"],"id":232}],[{"start":{"row":19,"column":0},"end":{"row":19,"column":1},"action":"insert","lines":["#"],"id":233}],[{"start":{"row":19,"column":1},"end":{"row":19,"column":2},"action":"insert","lines":[" "],"id":234}],[{"start":{"row":19,"column":2},"end":{"row":19,"column":7},"action":"insert","lines":["レスポンス"],"id":235}],[{"start":{"row":222,"column":8},"end":{"row":222,"column":40},"action":"remove","lines":["return Response(serializer.data)"],"id":236},{"start":{"row":222,"column":8},"end":{"row":224,"column":23},"action":"insert","lines":["        response = HttpResponse(ImageSerializer.select(user.id), status=200)","        response['content-type'] = 'application/json; charset=utf-8'","        return response"]}],[{"start":{"row":222,"column":12},"end":{"row":222,"column":16},"action":"remove","lines":["    "],"id":237},{"start":{"row":222,"column":8},"end":{"row":222,"column":12},"action":"remove","lines":["    "]}],[{"start":{"row":222,"column":32},"end":{"row":222,"column":63},"action":"remove","lines":["ImageSerializer.select(user.id)"],"id":238}],[{"start":{"row":222,"column":32},"end":{"row":222,"column":33},"action":"insert","lines":["s"],"id":239},{"start":{"row":222,"column":33},"end":{"row":222,"column":34},"action":"insert","lines":["e"]},{"start":{"row":222,"column":34},"end":{"row":222,"column":35},"action":"insert","lines":["r"]},{"start":{"row":222,"column":35},"end":{"row":222,"column":36},"action":"insert","lines":["i"]}],[{"start":{"row":222,"column":32},"end":{"row":222,"column":36},"action":"remove","lines":["seri"],"id":240},{"start":{"row":222,"column":32},"end":{"row":222,"column":42},"action":"insert","lines":["serializer"]}],[{"start":{"row":222,"column":42},"end":{"row":222,"column":43},"action":"insert","lines":["."],"id":241},{"start":{"row":222,"column":43},"end":{"row":222,"column":44},"action":"insert","lines":["d"]},{"start":{"row":222,"column":44},"end":{"row":222,"column":45},"action":"insert","lines":["a"]}],[{"start":{"row":222,"column":43},"end":{"row":222,"column":45},"action":"remove","lines":["da"],"id":242},{"start":{"row":222,"column":43},"end":{"row":222,"column":47},"action":"insert","lines":["data"]}],[{"start":{"row":222,"column":60},"end":{"row":223,"column":0},"action":"insert","lines":["",""],"id":243},{"start":{"row":223,"column":0},"end":{"row":223,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":223,"column":8},"end":{"row":223,"column":19},"action":"insert","lines":["import json"],"id":244}],[{"start":{"row":223,"column":0},"end":{"row":223,"column":19},"action":"remove","lines":["        import json"],"id":245}],[{"start":{"row":20,"column":44},"end":{"row":21,"column":0},"action":"insert","lines":["",""],"id":246},{"start":{"row":21,"column":0},"end":{"row":22,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":224,"column":60},"end":{"row":225,"column":0},"action":"remove","lines":["",""],"id":268},{"start":{"row":224,"column":59},"end":{"row":224,"column":60},"action":"remove","lines":[")"]}],[{"start":{"row":224,"column":59},"end":{"row":224,"column":60},"action":"insert","lines":[")"],"id":269}],[{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"insert","lines":["."],"id":281},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"insert","lines":["c"]},{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"insert","lines":["o"]}],[{"start":{"row":226,"column":24},"end":{"row":226,"column":26},"action":"remove","lines":["co"],"id":282},{"start":{"row":226,"column":24},"end":{"row":226,"column":31},"action":"insert","lines":["content"]}],[{"start":{"row":226,"column":30},"end":{"row":226,"column":31},"action":"remove","lines":["t"],"id":283},{"start":{"row":226,"column":29},"end":{"row":226,"column":30},"action":"remove","lines":["n"]},{"start":{"row":226,"column":28},"end":{"row":226,"column":29},"action":"remove","lines":["e"]},{"start":{"row":226,"column":27},"end":{"row":226,"column":28},"action":"remove","lines":["t"]},{"start":{"row":226,"column":26},"end":{"row":226,"column":27},"action":"remove","lines":["n"]},{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"remove","lines":["o"]},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"remove","lines":["c"]},{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"remove","lines":["."]}],[{"start":{"row":226,"column":23},"end":{"row":226,"column":25},"action":"insert","lines":["[]"],"id":285}],[{"start":{"row":226,"column":24},"end":{"row":226,"column":26},"action":"insert","lines":["''"],"id":286}],[{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"insert","lines":["o"],"id":287}],[{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"remove","lines":["o"],"id":288}],[{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"insert","lines":["c"],"id":289},{"start":{"row":226,"column":26},"end":{"row":226,"column":27},"action":"insert","lines":["o"]},{"start":{"row":226,"column":27},"end":{"row":226,"column":28},"action":"insert","lines":["n"]},{"start":{"row":226,"column":28},"end":{"row":226,"column":29},"action":"insert","lines":["t"]},{"start":{"row":226,"column":29},"end":{"row":226,"column":30},"action":"insert","lines":["e"]},{"start":{"row":226,"column":30},"end":{"row":226,"column":31},"action":"insert","lines":["n"]},{"start":{"row":226,"column":31},"end":{"row":226,"column":32},"action":"insert","lines":["t"]}],[{"start":{"row":226,"column":8},"end":{"row":226,"column":14},"action":"remove","lines":["return"],"id":290}],[{"start":{"row":226,"column":8},"end":{"row":226,"column":9},"action":"insert","lines":["p"],"id":291},{"start":{"row":226,"column":9},"end":{"row":226,"column":10},"action":"insert","lines":["r"]},{"start":{"row":226,"column":10},"end":{"row":226,"column":11},"action":"insert","lines":["i"]},{"start":{"row":226,"column":11},"end":{"row":226,"column":12},"action":"insert","lines":["o"]},{"start":{"row":226,"column":12},"end":{"row":226,"column":13},"action":"insert","lines":["n"]},{"start":{"row":226,"column":13},"end":{"row":226,"column":14},"action":"insert","lines":["t"]}],[{"start":{"row":226,"column":13},"end":{"row":226,"column":14},"action":"remove","lines":["t"],"id":292},{"start":{"row":226,"column":12},"end":{"row":226,"column":13},"action":"remove","lines":["n"]},{"start":{"row":226,"column":11},"end":{"row":226,"column":12},"action":"remove","lines":["o"]}],[{"start":{"row":226,"column":11},"end":{"row":226,"column":12},"action":"insert","lines":["n"],"id":293},{"start":{"row":226,"column":12},"end":{"row":226,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":226,"column":13},"end":{"row":226,"column":15},"action":"insert","lines":["()"],"id":294}],[{"start":{"row":226,"column":16},"end":{"row":226,"column":35},"action":"remove","lines":["response['content']"],"id":295}],[{"start":{"row":226,"column":14},"end":{"row":226,"column":33},"action":"insert","lines":["response['content']"],"id":296}],[{"start":{"row":226,"column":35},"end":{"row":227,"column":0},"action":"insert","lines":["",""],"id":297},{"start":{"row":227,"column":0},"end":{"row":227,"column":8},"action":"insert","lines":["        "]},{"start":{"row":227,"column":8},"end":{"row":227,"column":9},"action":"insert","lines":["e"]}],[{"start":{"row":227,"column":8},"end":{"row":227,"column":9},"action":"remove","lines":["e"],"id":298}],[{"start":{"row":227,"column":8},"end":{"row":227,"column":9},"action":"insert","lines":["r"],"id":299},{"start":{"row":227,"column":9},"end":{"row":227,"column":10},"action":"insert","lines":["e"]},{"start":{"row":227,"column":10},"end":{"row":227,"column":11},"action":"insert","lines":["t"]},{"start":{"row":227,"column":11},"end":{"row":227,"column":12},"action":"insert","lines":["u"]},{"start":{"row":227,"column":12},"end":{"row":227,"column":13},"action":"insert","lines":["r"]},{"start":{"row":227,"column":13},"end":{"row":227,"column":14},"action":"insert","lines":["n"]}],[{"start":{"row":227,"column":14},"end":{"row":227,"column":15},"action":"insert","lines":[" "],"id":300},{"start":{"row":227,"column":15},"end":{"row":227,"column":16},"action":"insert","lines":["r"]},{"start":{"row":227,"column":16},"end":{"row":227,"column":17},"action":"insert","lines":["e"]},{"start":{"row":227,"column":17},"end":{"row":227,"column":18},"action":"insert","lines":["s"]}],[{"start":{"row":227,"column":15},"end":{"row":227,"column":18},"action":"remove","lines":["res"],"id":301},{"start":{"row":227,"column":15},"end":{"row":227,"column":23},"action":"insert","lines":["response"]}],[{"start":{"row":226,"column":22},"end":{"row":226,"column":33},"action":"remove","lines":["['content']"],"id":302},{"start":{"row":226,"column":22},"end":{"row":226,"column":23},"action":"insert","lines":["."]},{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"insert","lines":["c"]},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"insert","lines":["o"]},{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"insert","lines":["n"]}],[{"start":{"row":226,"column":23},"end":{"row":226,"column":26},"action":"remove","lines":["con"],"id":303},{"start":{"row":226,"column":23},"end":{"row":226,"column":30},"action":"insert","lines":["content"]}],[{"start":{"row":226,"column":30},"end":{"row":226,"column":32},"action":"insert","lines":["()"],"id":304}],[{"start":{"row":226,"column":31},"end":{"row":226,"column":32},"action":"remove","lines":[")"],"id":305},{"start":{"row":226,"column":30},"end":{"row":226,"column":32},"action":"remove","lines":["()"]},{"start":{"row":226,"column":29},"end":{"row":226,"column":30},"action":"remove","lines":["t"]},{"start":{"row":226,"column":28},"end":{"row":226,"column":29},"action":"remove","lines":["n"]},{"start":{"row":226,"column":27},"end":{"row":226,"column":28},"action":"remove","lines":["e"]},{"start":{"row":226,"column":26},"end":{"row":226,"column":27},"action":"remove","lines":["t"]},{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"remove","lines":["n"]},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"remove","lines":["o"]},{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"remove","lines":["c"]},{"start":{"row":226,"column":22},"end":{"row":226,"column":23},"action":"remove","lines":["."]}],[{"start":{"row":226,"column":22},"end":{"row":226,"column":24},"action":"insert","lines":["[]"],"id":306}],[{"start":{"row":226,"column":23},"end":{"row":226,"column":37},"action":"insert","lines":["'content-type'"],"id":307}],[{"start":{"row":226,"column":38},"end":{"row":226,"column":39},"action":"remove","lines":[" "],"id":308}],[{"start":{"row":226,"column":38},"end":{"row":226,"column":39},"action":"insert","lines":[")"],"id":309}],[{"start":{"row":226,"column":15},"end":{"row":226,"column":38},"action":"remove","lines":["esponse['content-type']"],"id":310},{"start":{"row":226,"column":14},"end":{"row":226,"column":15},"action":"remove","lines":["r"]}],[{"start":{"row":226,"column":14},"end":{"row":226,"column":15},"action":"insert","lines":["r"],"id":311},{"start":{"row":226,"column":15},"end":{"row":226,"column":16},"action":"insert","lines":["e"]},{"start":{"row":226,"column":16},"end":{"row":226,"column":17},"action":"insert","lines":["p"]}],[{"start":{"row":226,"column":16},"end":{"row":226,"column":17},"action":"remove","lines":["p"],"id":312}],[{"start":{"row":226,"column":16},"end":{"row":226,"column":17},"action":"insert","lines":["s"],"id":313},{"start":{"row":226,"column":17},"end":{"row":226,"column":18},"action":"insert","lines":["p"]},{"start":{"row":226,"column":18},"end":{"row":226,"column":19},"action":"insert","lines":["o"]},{"start":{"row":226,"column":19},"end":{"row":226,"column":20},"action":"insert","lines":["n"]},{"start":{"row":226,"column":20},"end":{"row":226,"column":21},"action":"insert","lines":["s"]},{"start":{"row":226,"column":21},"end":{"row":226,"column":22},"action":"insert","lines":["e"]}],[{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"insert","lines":["r"],"id":314},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"insert","lines":["u"]},{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"insert","lines":["n"]}],[{"start":{"row":226,"column":25},"end":{"row":226,"column":26},"action":"remove","lines":["n"],"id":315},{"start":{"row":226,"column":24},"end":{"row":226,"column":25},"action":"remove","lines":["u"]},{"start":{"row":226,"column":23},"end":{"row":226,"column":24},"action":"remove","lines":["r"]}]]},"ace":{"folds":[],"scrolltop":3253,"scrollleft":0,"selection":{"start":{"row":226,"column":23},"end":{"row":226,"column":23},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":202,"state":"start","mode":"ace/mode/python"}},"timestamp":1571540461002}